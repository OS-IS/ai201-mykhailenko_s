# 4.7.10 Тестування ін'єкції IMAP SMTP (WSTG-INPV-10)

## Резюме
Ця загроза впливає на всі додатки, які спілкуються з поштовими серверами (IMAP/SMTP), зазвичай веб-поштові додатки. Метою є перевірка здатності ін'єктувати довільні команди IMAP/SMTP в поштові сервери через неналежно санітизовані вхідні дані.

## Цілі тестування
- Виявити точки ін'єкції IMAP/SMTP
- Зрозуміти потік даних і структуру розгортання системи
- Оцінити вплив ін'єкції

## Як тестувати

### Виявлення вразливих параметрів
Для виявлення вразливих параметрів проаналізуйте обробку вводу додатка, надсилаючи фальшиві або шкідливі запити та аналізуючи відповіді.

У безпечному додатку відповіддю повинна бути помилка. У вразливому додатку шкідливі запити можуть оброблятися з відповіддю `HTTP 200 OK`.

Спеціальні параметри IMAP для тестування включають:
- Автентифікація
- Відправник/отримувач електронної пошти
- Операції з поштовою скринькою
- Операції з повідомленнями
- Тема
- Роз'єднання
- Тіло повідомлення
- Прикріплені файли

### Розуміння потоку даних і структури розгортання
Після виявлення вразливих параметрів визначте можливий рівень ін'єкції та розробіть план тестування.

### Ін'єкція команд IMAP/SMTP
Ін'єкція можлива в двох сценаріях:
1. Неавтентифікований стан (обмежені команди)
2. Автентифікований стан

Типова структура ін'єкції:
- Заголовок: закінчення очікуваної команди
- Тіло: ін'єкція нової команди
- Нижній колонтитул: початок очікуваної команди

## Посилання
- RFC 0821 "Simple Mail Transfer Protocol"
- RFC 3501 "Internet Message Access Protocol"  
- Vicente Aguilera Díaz: "MX Injection: Capturing and Exploiting Hidden Mail Servers"